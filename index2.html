<!DOCTYPE html>
<html>
<head>
    <title>Robots</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<header>
  <h2>Robots by Categories</h2>
</header>
<div class="container">
   <button class="btn btn-info my-4" onclick="showList()">Show Categories</button>  
  <section>
    <div id="components">
      <label id="comp-label">Categories</label>
      <hr>
      <ul id="lista">
        
      </ul>
    </div>
    
    <div id="component-card">
      <h3 id="c-name">Robots</h3><hr>
      <table id="tableId">
        <thead>
          <tr>
            <th class="text-center" width="10%">Name</th>
            <th class="text-center" width="10%">Image</th>
            <th class="text-center" width="30%">Infos</th>
          </tr>
         </thead>
         <tbody>
           
           
        </tbody>
      </table>
    </div>
    
  </section>
  <form id="insertForm">
    <h4 class="my-4">Insert new robot</h4>
    <div class="form-group">
      <label for="denumire">Name</label>
      <input type="text" class="form-control" id="denumire" placeholder="Denumire">
    </div>
    <div class="form-group">
      <label for="manufacturer">Manufacturer</label>
      <input type="number" class="form-control" id="manufacturer" placeholder="manufacturer">
    </div>
    <!-- <button class="btn btn-primary de-inserat" onclick="trimite(this.id)">Insereaza</button> -->
    <button class="btn btn-primary de-inserat" onclick="insertRobot(this.id); return false;">Insert</button>
  </form>

<script>
  function showList() {
   var x = document.getElementById("components");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}

bringCategories();

function bringCategories() {
  let url = 'select3.php';

  $.ajax({
    type: "GET",
    url: url,
	 success: function (response) {
     let final = JSON.parse(response)
    //  console.log(final.results.bindings);
    final.results.bindings.forEach((item, index)=>{
      $( "#lista" ).append( "<li class='mt-4'><a href='#' onclick='getDetails(this.id)' id='"+item.categorie.value+ "' class='text-decoration-none text-dark' ><b>" + item['nume'].value + "</b></a> </li> "  );
      })
    }
  });
}

function getDetails( id) {
  console.log(id);
  let url = "query3.php";
  $.ajax({
    type: "POST",
    url:url,
    data: {"id": id },
    success: function (response){
      let final = JSON.parse(response);
      console.log(final.results.bindings)
      $('#tableId').find('tbody')
          .empty();

      final.results.bindings.forEach((item, index)=>{   
        console.log(item);
        if (item.skills && item.manufacturer && item.releaseDate &&  item.image.value) { 
          s = item.name.value;
          id = s.split(" ").join("");  //titlul filmelor il transformam in id prin eliminarea spatiilor si concatenarea cuvintelor

             $('#tableId').find('tbody')
                .append($(`<tr id=${id} class="border_bottom">`)
                  .append($('<td class="mt-3 text-center">')
                    .append(`<p class='mt-4'><b><i>${item.name.value} </i></b></p><br><button class='btn btn-danger' id='${item.name.value}' onclick="deleteMovie(this.id, '${id}')">Sterge</button></div>`)
                  )
                  .append($('<td class="text-center">')
                    .append($('<img height="150" width="250">')
                      .attr('src', 'images/'+item.image.value)
                    )
                  )
                  .append($('<td>')
                    // .append($('<small> Manufacturer: </small><p>'+ item.manufacturer.value+ '</p><small>Release date: </small><p>' + item.releaseDate.value +'</p><small>Skills: </small><p>'+item.skills.value +'</p><small> Mass: </small><p>'+item.mass.value + ' kg</p><small>For sale: </small>'+(item.sale.value) ? '<p>Yes</p>' : '<p>No</p>'+'</p>'))
                    .append($('<small> Manufacturer: </small><p>'+ item.manufacturer.value+ '</p><small>Release date: </small><p>' + item.releaseDate.value +'</p><small>Skills: </small><p>'+item.skills.value +'</p><small> Mass: </small><p>'+item.mass.value + ' kg</p>'))
                  )
                )
                
        } else {

          // $('#tableId').find('tbody')
          //       .append($(`<tr id=${id}>`)
          //         .append($('<td class="mt-3 text-center">')
          //           .append(`<p class='mt-4'><b>${item.name.value} </b></p><br><button class='btn btn-danger' id='${item.movie.value}' onclick="deleteMovie(this.id, '${id}')">Sterge</button></div>`)
          //         )
          //         .append($('<td class="text-center">')
          //           .append($('<img height="150" width="250">')
          //             .attr('src', 'img/'+item.image.value)
          //           )
          //         )
          //         .append($('<td>')
          //           .append($('<small> manufacturer: </small><p>'+ item.manufacturer.value+ '</p><small>Release date: </small><p>' + item.releaseDate.value +'</p>'))
          //         )
          //       )

        }
        let button = document.querySelector('.de-inserat');
        button.setAttribute("id", item.name.value);   //setam id-ul butonului ca fiind uri-ul actorului => inserarea se face pe baza atributului
      })
      
    }
  });
}

function deleteMovie(uri, sterge) {
  $.ajax({
    type: "POST",
    url:"delete3.php",
    data: {
      uri: uri
    },
    success: function(response) {
      $("#"+sterge).remove();
    }
  })
}

function insertRobot(uri, event) {
  event.preventDefault();
  let url = "insert3.php";

  let uriNou = $('#denumire').val();
  let buget = $('#buget').val();

  $.ajax({
    type: "POST",
    url:url,
    data: {
      uri: uri,
      uriNou: uriNou,
      buget: buget
    },
    success: function(response) {
      console.log(response.responseText);
      // if(response.status == 202) {
      //   alert('Film inserat cu succes');
      // } else {
      //   alert('URI-ul exista deja in baza de cunostinte');
      // }
      var data =JSON.parse(response);
             if (data.status == 200) {
               alert("It worked");
             }
             else {
                 alert("It didn't");
                  console.log(response.responseText);
             }
    }
  })
}

</script>
</body>
</html>