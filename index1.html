<!DOCTYPE html>
<html>
<head>
    <title>Semantic Web Project</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<header>
  <h2>Semantic Web Project</h2>
</header>
<div class="container">
   <button class="btn btn-info my-4" onclick="showList()">Afișează componente</button>  
  <section>
    <div id="components">
      <label id="comp-label">Actors</label>
      <hr>
      <ul id="lista">
        
      </ul>
    </div>
    
    <div id="component-card">
      <h3 id="c-name">Movies</h3><hr>
      <table id="tableId">
        <thead>
          <tr>
            <th class="text-center" width="10%">Denumire</th>
            <th class="text-center" width="10%">Imagine</th>
            <th class="text-center" width="10%">Informatii</th>
          </tr>
         </thead>
         <tbody>
           
           
        </tbody>
      </table>
    </div>
    
  </section>
  <form id="insertForm">
    <h4 class="my-4">Formular inserare film</h4>
    <div class="form-group">
      <label for="denumire">Denumire</label>
      <input type="text" class="form-control" id="denumire" placeholder="Denumire">
    </div>
    <div class="form-group">
      <label for="buget">Buget</label>
      <input type="number" class="form-control" id="buget" placeholder="Buget">
    </div>
    <!-- <button class="btn btn-primary de-inserat" onclick="trimite(this.id)">Insereaza</button> -->
    <button class="btn btn-primary de-inserat" onclick="insereazaFilm(this.id)">Insereaza</button>
  </form>

<script>
  function showList() {
   var x = document.getElementById("components");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}

bringActors();

function bringActors() {
  let url = 'select2.php';

  $.ajax({
    type: "GET",
    url: url,
	 success: function (response) {
     let final = JSON.parse(response)
     
    final.results.bindings.forEach((item, index)=>{
      $( "#lista" ).append( "<li class='mt-4'><a href='#' onclick='getDetails(this.id)' id='"+item.subiect.value+ "' class='text-decoration-none text-dark' ><b>" + item['nume'].value + "</b></a> </li> "  );
      })
    }
  });
}

function getDetails( id) {
  console.log(id);
  let url = "query1.php";
  $.ajax({
    type: "POST",
    url:url,
    data: {"id": id },
    success: function (response){
      let final = JSON.parse(response);
      $('#tableId').find('tbody')
          .empty();

      final.results.bindings.forEach((item, index)=>{   
        console.log(item);
        if (item.buget && item.director && item.releaseDate &&  item.image.value) {   //buget = OPTIONAL
          s = item.movieTitle.value;
          id = s.split(" ").join("");  //titlul filmelor il transformam in id prin eliminarea spatiilor si concatenarea cuvintelor

             $('#tableId').find('tbody')
                .append($(`<tr id=${id}>`)
                  .append($('<td class="mt-3 text-center">')
                    .append(`<p class='mt-4'><b><i>${item.movieTitle.value} </i></b></p><br><button class='btn btn-danger' id='${item.movie.value}' onclick="deleteMovie(this.id, '${id}')">Sterge</button></div>`)
                  )
                  .append($('<td class="text-center">')
                    .append($('<img height="150" width="250">')
                      .attr('src', 'img/'+item.image.value)
                    )
                  )
                  .append($('<td>')
                    .append($('<small> Director: </small><p>'+ item.director.value+ '</p><small>Release date: </small><p>' + item.releaseDate.value +'</p><small> Buget: </small><p>'+item.buget.value + '</p>'))
                  )
                )
                
        } else {

          $('#tableId').find('tbody')
                .append($(`<tr id=${id}>`)
                  .append($('<td class="mt-3 text-center">')
                    .append(`<p class='mt-4'><b>${item.movieTitle.value} </b></p><br><button class='btn btn-danger' id='${item.movie.value}' onclick="deleteMovie(this.id, '${id}')">Sterge</button></div>`)
                  )
                  .append($('<td class="text-center">')
                    .append($('<img height="150" width="250">')
                      .attr('src', 'img/'+item.image.value)
                    )
                  )
                  .append($('<td>')
                    .append($('<small> Director: </small><p>'+ item.director.value+ '</p><small>Release date: </small><p>' + item.releaseDate.value +'</p>'))
                  )
                )

        }
        let button = document.querySelector('.de-inserat');
        button.setAttribute("id", item.actor.value);   //setam id-ul butonului ca fiind uri-ul actorului => inserarea se face pe baza atributului
      })
      
    }
  });
}

function deleteMovie(uri, sterge) {
  $.ajax({
    type: "POST",
    url:"delete.php",
    data: {
      uri: uri
    },
    success: function(response) {
      $("#"+sterge).remove();
    }
  })
}

function insereazaFilm(uri) {
  let url = "insert.php";

  let uriNou = $('#denumire').val();
  let buget = $('#buget').val();

  $.ajax({
    type: "POST",
    url:url,
    data: {
      uri: uri,
      uriNou: uriNou,
      buget: buget
    },
    success: function(response) {
      console.log(response);
      // if(response.status == 202) {
      //   alert('Film inserat cu succes');
      // } else {
      //   alert('URI-ul exista deja in baza de cunostinte');
      // }
    }
  })
}

</script>
</body>
</html>